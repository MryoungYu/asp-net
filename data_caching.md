# ASP.NET - 数据缓存
## 什么是缓存？
缓存是一种将经常使用的数据/信息存储在内存中的技术,这样,下次需要相同的数据/信息时,可以直接从内存检索,而不是再从应用程序中生成。  
缓存在用于提高ASP性能方面是非常重要的，因为ASP的页面和控件是都动态生成的。这对于交互相关的数据是极其重要的,因为响应时间是很宝贵的。  
在需要快速访问的媒体，如计算机的随机存取存储器，缓存放置了被频繁使用的数据。ASP的运行时间包含一个叫做缓存的CLR对象的键值对。它位于应用程序内,并且通过HttpContext和System.Web.UI.Page可用。  
在某些方面，缓存和存储状态对象有相似之处。然而，状态对象的存储信息是确定的，比如，你可以计算存储在状态对象的数据，但是缓存的数据是不确定的。  
在下列情况里，数据是不可用的：  

- 如果它的生命周期已结束
- 如果该应用释放了它的内存
- 如果由于某些原因缓存没有被替换

您可以使用一个索引器在缓存中访问项目,并且有可能控制缓存中对象的生命周期和设置缓存的对象及其物理资源之间的联系。  
## ASP.NET中的缓存
ASP提供如下几种不同类型的缓存：  

- **输出缓存**：输出缓存可以存储最后显现的网页的副本，或者是发送到客户机的部分页面。下次客户机请求该页面时，这个页面的缓存副本就会被发送给客户机，而不是重新生成这个页面，这样一来就节省了时间。  
- **数据缓存**：数据缓存是指从数据源缓存数据。只要缓存没被替换，那么再请求该数据时就会从缓存中获取。当缓存被替换的时候，会从数据源中获取新数据，缓存也会被再次充满。  
- **对象缓存**：对象缓存是缓存页面的对象，比如数据绑定控件等。缓存的数据放在服务器的内存。  
- **类缓存**：网页或Web服务是第一次运行时在组装编译成页类。然后组装会在服务器缓存。当下次请求该页面或者服务,就会使用缓存的装配。当改变源代码时,CLR重新编译程序集。  
- **配置缓存**：应用程序配置信息存储在一个配置文件。配置缓存存储在服务器内存配置信息。

在本教程中,我们将考虑输出缓存,数据缓存和对象缓存。  
## 输出缓存
呈现一个页面可能涉及一些复杂的过程,如,数据库访问，呈现复杂的控件等。输出缓存允许通过在内存中缓存数据，而绕过往返服务器。甚至可以缓存整个页面。  
OutputCache指令负责输出缓存。它启用输出缓存,并对其行为提供一定程度的控制。  
OutputCache指令的语法：  

```
<%@ OutputCache Duration="15" VaryByParam="None" %>
```

把这个指令放在页面指令下。这告诉环境需要缓存页面,持续15秒。以下页面加载事件处理程序将帮助确认页面是否已被缓存完毕。  

```
protected void Page_Load(object sender, EventArgs e)
{
    Thread.Sleep(10000);  
    Response.Write("This page was generated and cache at:" +
    DateTime.Now.ToString());
}
```

**Thread.Sleep()** 方法使特定时间内的进程停止。在这个例子中，线程停止了10秒钟，因此，当页面第一次下载时，需要花费10秒钟的时间。然而，下次刷新页面的时候，就不会花费时间了，因为这个页面已经从缓存中获取了，不要再下载。  
当帮助控制输出缓存的行为OutputCache指令有以下特性:  


|性质   | 值   |描述      |
|:---------|:------------|  
|带有缓存的磁盘|是/否|描述输出是否可以写入带有缓存的磁盘 |  
|无存储|是/否|描述无存储缓存头是否被发送|
|缓存配置|字符串名|存储在web.config中的缓存配置文件名字|
|改变参数|空或者*或者是参数名|GET请求中使用分号分隔的字符串值或者是POST请求中的变量值|
|改变头|*或者头文件名|可能是由客户端提交的用分号分隔的指定头的字符串|
|改变客户|浏览器或者是客户字符串|通知ASP.NET通过浏览器名字版本或者客户端字符串改变输出缓存|
|位置|任何或者是客户端或者是下载流或者是服务端或者是空||
|生命周期|数字||